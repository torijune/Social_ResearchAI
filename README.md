# Social_ResearchAI: 설문조사 표 자동 분석 & 요약 시스템

이 프로젝트는 엑셀 기반의 설문조사 결과를 자동 전처리하고, **수치 기반 분석**과 **LLM을 활용한 요약 생성**을 결합하여 **신뢰성 있는 통계 해석 리포트**를 자동 생성합니다.

---

## 주요 기능

1. **엑셀 테이블 자동 파싱**
   - 질문 항목 키(A1, B13 등)를 기준으로 설문 문항별 테이블 자동 분할
   - 병합 헤더 해소, 무응답/기타 항목 제거, 수치 정제(소수점 1자리 반올림)

2. **수치 기반 분석 기능**
   - ***Wang et al., 2021*** 의 ***skeleton*** 추출 후, LLM에게 같이 제공하는 방식을 활용
   - 모든 수치형 컬럼에 대해 **평균, 표준편차, 최대/최소 그룹, 분산 범위(range)** 등을 자동 분석
   - '대분류(예: 성별, 연령)'별로 '소분류(예: 여성, 30대)' 간의 유의미한 수치 차이 추출
   - 기준값 이상(예: 표준편차 3 이상, 범위 5 이상)일 때만 **Insight 요약에 포함**

3. **테이블 → 자연어 변환 (Linearization)**
   - 테이블을 자연어 기반 서술문 형태로 변환하여 LLM 입력에 최적화
   - 다양한 포맷 지원: 자연어 문장, 마크다운, JSON 등

4. **LLM 기반 요약 생성 (OpenAI 또는 Ollama)**
   - 수치 기반 분석 결과를 함께 제공하여, **근거 중심의 정량 요약문** 생성
   - Chain-of-Thought (CoT) 유도 프롬프트 포함: 수치 간 비교, 극단값 강조, 단락 요약 유도

---
## ResearchAI Framework Overview
```
Input: [표 + 수치 분석 + 질문 문장]
        ↓
    1️⃣ Skeleton 추출
        - 평균, 극단값, 표준편차 등의 주요 수치 기반 요점을 도출
        - 요약에 반드시 포함되어야 할 핵심 정보 리스트 생성

    2️⃣ Summary 생성
        - 표 데이터와 Skeleton, 분석 결과를 종합하여 서술형 요약문 생성
        - Chain-of-Thought 기반 프롬프트로 비교 및 패턴 유도

    3️⃣ Review 피드백
        - 별도의 고성능 LLM(GPT-4o 등)을 통해 요약 품질 검토
        - 논리성, 수치 일관성, 개선점 등을 포함한 리뷰 생성

    4️⃣ Final Report 생성
        - 리뷰 피드백을 반영한 최종 요약문 재작성
        - 더 정제되고 신뢰도 높은 통계 기반 보고서 완성
        ↓
Output: [최종 리포트]
```

---

## 예시 요약 결과 for Question A1:
### Input Table (요약; 8 Rows)

| 대분류 | 소분류     | 사례수 | 질문_1 (%) | 질문_2 (%) | ... | 질문_3 (5점 척도) |
|--------|------------|--------|--------------------|--------------|------|----------------|
| 전체   | -          | 1000   | 19.1               | 72.8         | ... | 3.9            |
| 성별   | 남성       | 494    | 19.4               | 72.3         | ... | 3.9            |
| 성별   | 여성       | 506    | 18.8               | 73.3         | ... | 3.9            |
| 연령   | 20대       | 181    | 14.9               | 64.1         | ... | 3.7            |
| 연령   | 30대       | 244    | 19.3               | 68.0         | ... | 3.8            |
| 연령   | 40대       | 205    | 18.5               | 69.8         | ... | 3.8            |
| 연령   | 50대       | 167    | 16.8               | 76.6         | ... | 3.9            |
| 연령   | 60대 이상  | 203    | 25.1                | 86.2         | ... | 4.1            |
|...    | ...      | ...    | ...                 | ...          | ... | ...            |
| 대기오염 배출사업장 | 없다 | 464 | 15.9               | 66.2	        | ... | 3.7            |

↓

---

### 1. 스켈레톤(Skeleton) 요점 집중 - LLM (LLaMA-3.1-8B-Instruct)

1. **대기환경 문제 관심도는 평균 3.8, 표준편차 0.9로 상대적으로 작은 편**
2. **60대는 평균 4.1로 가장 높은 관심도를 보임**
3. **실외 체류자는 '매우 관심 있다' 비율이 25.9%로 가장 높음**
4. **기저질환자 보유 여부에 따라 '관심있다' 비율이 11% 차이남**
5. **대기오염 배출 사업장 유무에 따라 평균 관심도는 0.3점 차이남**

↓

---

### 2. Pandas 수치적(Nnmeric) 분석 결과 - Pandas + LLM

[연령] 항목에서는 다음과 같은 특이점이 관찰되었습니다.
- '대체로 관심이 없는 편' 항목은 '20대' 그룹에서 가장 높고, '60대이상' 그룹에서 가장 낮았습니다. 해당 항목의 값 범위는 6.7이며, 표준편차는 2.47입니다.
...
- '관심있다 %' 항목은 '60대이상' 그룹에서 가장 높고, '20대' 그룹에서 가장 낮았습니다. 해당 항목의 값 범위는 22.1이며, 표준편차는 8.68입니다.

[생활권역] 항목에서는 다음과 같은 특이점이 관찰되었습니다.
- '대기환경 문제 관심정도 전혀 관심이 없다' 항목은 '도심권' 그룹에서 가장 높고, '서북권' 그룹에서 가장 낮았습니다. 해당 항목의 값 범위는 5.9이며, 표준편차는 2.57입니다.
...
- '관심있다 %' 항목은 '도심권' 그룹에서 가장 높고, '서북권' 그룹에서 가장 낮았습니다. 해당 항목의 값 범위는 5.6이며, 표준편차는 2.39입니다.

...

[대기오염 배출사업장] 항목에서는 다음과 같은 특이점이 관찰되었습니다.
- '보통' 항목은 '없다' 그룹에서 가장 높고, '있다' 그룹에서 가장 낮았습니다. 해당 항목의 값 범위는 9.1이며, 표준편차는 6.43입니다.
...
- '관심있다 %' 항목은 '있다' 그룹에서 가장 높고, '없다' 그룹에서 가장 낮았습니다. 해당 항목의 값 범위는 12.3이며, 표준편차는 8.7입니다.

↓

---

### 3. Report 초안 생성 - LLM (LLaMA-3.1-8B-Instruct)

대기환경 문제 관심도는 평균 3.8, 표준편차 0.9로 상대적으로 작은 편입니다. 60대가 평균 4.1로 가장 높은 관심도를 보였습니다. 실외 체류자는 '매우 관심 있다' 비율이 25.9%로 가장 높았으며, 기저질환자 보유 여부에 따라 '관심있다' 비율이 11% 차이가 났고 대기오염 배출 사업장 유무에 따라 평균 관심도는 0.3점 차이가 났습니다.

↓

---

### 4. Report에 대한 review - LLM (GPT-4o)

- 간단한 평가:
  - 좋은 점:
    1. 요약은 질문의 의도와 관련된 핵심 정보를 잘 담고 있습니다. 특히, 평균 관심도와 특정 그룹(60대, 실외 체류자, 기저질환자 등)의 관심도 차이를 명확히 제시하고 있습니다.
    2. 수치 기반 통계 정보가 적절히 반영되어 있어 독자가 데이터를 쉽게 이해할 수 있습니다.
  
  - 개선점:
    1. 요약에서 언급된 표준편차 0.9는 원본 데이터에 포함되어 있지 않으므로, 이 부분은 제거하거나 출처를 명확히 해야 합니다.
    2. '기저질환자 보유 여부에 따라 '관심있다' 비율이 11% 차이가 났다'는 부분은 구체적인 수치로 설명이 부족합니다. 원본 데이터에서 기저질환자 여부에 따른 '관심있다' 비율 차이는 10.4%입니다. 이를 명확히 해야 합니다.
    3. 문장이 조금 더 간결하게 다듬어질 수 있습니다. 예를 들어, '대기오염 배출 사업장 유무에 따라 평균 관심도는 0.3점 차이가 났습니다.'는 '대기오염 배출 사업장 유무에 따라 평균 관심도는 0.3점 차이가 있습니다.'로 수정할 수 있습니다.

- 다듬은 버전 제안:
  대기환경 문제에 대한 관심도는 평균 3.8로 나타났습니다. 60대는 평균 4.1로 가장 높은 관심을 보였으며, 실외 체류자는 '매우 관심 있다' 비율이 25.9%로 가장 높았습니다. 기저질환자 여부에 따라 '관심있다' 비율은 78.3%와 67.9%로 10.4% 차이가 있었고, 대기오염 배출 사업장 유무에 따라 평균 관심도는 4.0과 3.7로 0.3점 차이가 있었습니다.

↓

---

### 5. 최종 Report 생성 - LLM (GPT-4o)

> 대기환경 문제에 대한 관심도는 평균 3.8로 나타났습니다. 60대는 평균 4.1로 가장 높은 관심을 보였으며, 실외 체류자는 '매우 관심 있다' 비율이 25.9%로 가장 높았습니다. 기저질환자 여부에 따라 '관심있다' 비율은 각각 78.3%와 67.9%로 10.4% 차이가 있었고, 대기오염 배출 사업장 유무에 따라 평균 관심도는 각각 4.0과 3.7로 0.3점 차이가 있었습니다.

---

## 실행 예시

```bash
# 가상환경 설정 (선택)
python -m venv venv
source venv/bin/activate

# 라이브러리 설치
pip install -r requirements.txt

# 전체 파이프라인 실행 (엑셀 → 분석 → 요약)
python main/Social_ResearchAI.py
```
